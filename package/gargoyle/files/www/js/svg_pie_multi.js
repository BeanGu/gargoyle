/*
	This program is copyright 2008,2009,2013 Eric Bishop and is distributed under the terms of the GNU GPL 
	version 2.0. 
	See http://gargoyle-router.com/faq.html#qfoss for more information
*/function init(e){svgDoc=e.target.ownerDocument}function addPercentsToLabel(e,t,n){var r=[],i;for(i=0;i<t.length;i++)pct=Math.floor(parseFloat(t[i])*1e3/n[i])/10,pctStr=""+pct+"%",r.push(pctStr);var s=e+" ( "+r.join(" / ")+" )";return s}function setPieChartData(e,t,n,r,i,s,o,u){if(svgDoc==null)return[];i=parseInt(i),s=parseInt(s),initialized||(o=!0);var a=e.length;numPies=r.length;var f=[],l=0;for(l=0;l<e.length;l++)f.push(l);var c=function(e,t){return r[i][t]-r[i][e]};f.sort(c);if(o){visibleIndividuals=[],otherIndividuals=[],unselectedColors=[],selectedColors=[],numVisible=0,selectedId=null;var h=e.length<=s?s:s+1,p=[255,0,0],d=0;for(d=0;d<h;d++){var v=incrementColor(p,d*Math.ceil(360/h)),m=getSelectedRgb(v);unselectedColors.push(getColorStr(v)),selectedColors.push(getColorStr(m));if(d<s||h<=s)f[d]!=null&&(visibleIndividuals[e[f[d]]]=[getColorStr(v),getColorStr(m)],numVisible++);else{var g;for(g=d;g<f.length;g++)otherIndividuals[e[f[g]]]=[getColorStr(v),getColorStr(m)]}}initialized=!0}orderedNames=[];var y=[],b=[],w=[],E=-1,S;for(S=0;S<r.length;S++)b.push([]);while(f.length>0){var x=f.shift(),T=e[x],N=n[x];if(otherIndividuals[T]!=null||numVisible==s&&visibleIndividuals[T]==null){var C=0;for(C=0;C<numPies;C++)w[C]=(w[C]==null?0:w[C])+parseFloat(r[C][x])}else if(visibleIndividuals[T]!=null){orderedNames.push(T),y.push(N);for(C=0;C<numPies;C++)b[C].push(parseFloat(r[C][x]));if(visibleIndividuals[T]==null){var k=visibleIndividuals.length;visibleIndividuals[T]=[unselectedColors[k],selectedColors[k]],numVisible++}}}if(w.length>0){for(S=0;S<r.length;S++)b[S].push(w[S]);n.length>e.length?y.push(n[n.length-1]):y.push("Others")}var L=bottomCoor-topCoor+1,A=Math.ceil((rightCoor-leftCoor+1)/4);numPies>1&&(vertRadius=Math.ceil((bottomCoor-topCoor+1)/(2*numPies)*.85),A=A<vertRadius?A:vertRadius);var O=Math.floor((L-A*2*numPies)/(2*numPies)),M=Math.ceil(O*.8),_=Math.ceil(O*.3),D=Math.ceil(.0015*L),P=[],H=[],B;for(B=0;B<y.length;B++)P.push([]);var j=[],F;for(F=0;F<unselectedColors.length;F++){var I=unselectedColors.length+1,q;for(q=0;q<unselectedColors.length;q++){var R=orderedNames[q]!=null?orderedNames[q]:"others",U=R=="others"?unselectedColors[unselectedColors.length-1]:visibleIndividuals[R][0];I=U==unselectedColors[F]?q:I}j.push(I)}var z=[],W=[],S;for(S=0;S<numPies;S++){var X=rightCoor-(A+O),V=A+O+S*2*(A+O),$=svgDoc.createElementNS(svgNs,"text");$.setAttribute("x",X-A),$.setAttribute("y",V-A-_),$.setAttribute("font-size",M+"px"),$.setAttribute("font-family","serif"),$.setAttribute("font-weight","bold"),$.appendChild(svgDoc.createTextNode(t[S])),$.setAttribute("id","pie_title_"+S),W.push($);var J=0,K=X+A*Math.cos(J),Q=V+ -1*A*Math.sin(J),G=b[S],Y=0;for(Z=0;Z<G.length;Z++)Y=parseFloat(G[Z])+Y;if(Y==0)for(Z=0;Z<G.length;Z++)G[Z]=1,Y++;H.push(Y);for(F=0;F<j.length;F++){var Z=j[F],et=P[Z];if(et!=null){et.push(G[Z]);var tt=orderedNames[Z]!=null?orderedNames[Z]:"others",nt=tt=="others"?unselectedColors[unselectedColors.length-1]:visibleIndividuals[tt][0],rt=tt=="others"?selectedColors[selectedColors.length-1]:visibleIndividuals[tt][1];if(parseFloat(G[Z])!=0){var it=J+2*Math.PI*parseFloat(G[Z])/Y,st=X+A*Math.cos(it),ot=V+ -1*A*Math.sin(it),ut=st-K,at=ot-Q,ft=it-J>Math.PI?1:0,lt="M "+X+","+V+" L "+K+","+Q+" a"+A+","+A+" 0 "+ft+",0 "+ut+","+at+" z",ct=svgDoc.createElementNS(svgNs,"path");ct.setAttribute("d",lt),ct.setAttribute("stroke-linejoin","round"),G[Z]==Y&&(ct=svgDoc.createElementNS(svgNs,"circle"),ct.setAttribute("r",A),ct.setAttribute("cx",X),ct.setAttribute("cy",V)),ct.setAttribute("fill",nt),ct.setAttribute("stroke","black"),ct.setAttribute("stroke-width",D),ct.setAttribute("id","slice_"+S+"_"+Z),selectedId==Z&&(ct.setAttribute("stroke-width",2*D),ct.setAttribute("fill",rt)),ct.onmouseover=piePieceSelected,ct.onmouseout=piePieceDeselected,W.push(ct),K=st,Q=ot,J=it}}}}var ht=.005*L,pt=O-_,dt=Math.floor(.07*L),vt=Math.floor(.03*L),mt,gt=[];for(mt=0;mt<y.length;mt++){var yt=orderedNames[mt]!=null?orderedNames[mt]:"others";u=u==null?addPercentsToLabel:u;var bt=y[mt];bt==null&&(bt=mt>0&&mt==y.length-1?"Others":"Unknown");var wt=u(bt,P[mt],H),nt=unselectedColors[unselectedColors.length-1],rt=selectedColors[selectedColors.length-1];yt!="others"&&(nt=visibleIndividuals[yt][0],rt=visibleIndividuals[yt][1]);var Et=svgDoc.createElementNS(svgNs,"rect");Et.setAttribute("x",ht),Et.setAttribute("y",pt),Et.setAttribute("width",vt),Et.setAttribute("height",vt),Et.setAttribute("stroke","black"),Et.setAttribute("stroke-width",D),Et.setAttribute("id","color_"+mt),Et.setAttribute("fill",nt);var St=svgDoc.createElementNS(svgNs,"text");St.setAttribute("x",ht+vt*1.25),St.setAttribute("y",pt+vt*.85),St.setAttribute("font-size",Math.floor(vt*.7)+"px"),St.setAttribute("font-family","serif"),St.appendChild(svgDoc.createTextNode(wt)),St.setAttribute("id","label_"+mt),St.setAttribute("font-weight","normal"),selectedId==mt&&(Et.setAttribute("stroke-width",2*D),St.setAttribute("font-weight","bold"),Et.setAttribute("fill",rt));var xt=svgDoc.createElementNS(svgNs,"g");xt.setAttribute("id","group_"+mt),xt.appendChild(Et),xt.appendChild(St),xt.onmouseover=piePieceSelected,xt.onmouseout=piePieceDeselected,gt.push(xt),pt+=dt}var Tt=svgDoc.getElementById("pie_container");while(Tt.firstChild!=null)Tt.removeChild(Tt.firstChild);while(gt.length>0)Tt.appendChild(gt.shift());while(W.length>0)Tt.appendChild(W.shift());return H}function piePieceSelected(){id=this.id.match(/_([^_]*)$/)[1];var e=bottomCoor-topCoor+1,t=Math.ceil(.0015*e),n=2*t;if(id==selectedId)return;selectedId=id;var r=orderedNames[id]!=null?orderedNames[id]:"others",i=r=="others"?unselectedColors[unselectedColors.length-1]:visibleIndividuals[r][0],s=r=="others"?selectedColors[selectedColors.length-1]:visibleIndividuals[r][1];svgDoc.getElementById("color_"+id).setAttribute("stroke-width",n),svgDoc.getElementById("color_"+id).setAttribute("fill",s);var o=svgDoc.getElementById("label_"+id),u=o.firstChild.data;o.setAttribute("font-weight","bold"),o.removeChild(o.firstChild),o.appendChild(svgDoc.createTextNode(u));var a=svgDoc.getElementById("pie_container"),f;for(f=0;f<numPies;f++){var l=svgDoc.getElementById("slice_"+f+"_"+id);l!=null&&(l.setAttribute("stroke-width",n),l.setAttribute("fill",s),a.removeChild(l),a.appendChild(l))}}function piePieceDeselected(){id=this.id.match(/_([^_]*)$/)[1];var e=bottomCoor-topCoor+1,t=Math.ceil(.0015*e),n=2*t;id==selectedId&&(selectedId=null);var r=orderedNames[id]!=null?orderedNames[id]:"others",i=r=="others"?unselectedColors[unselectedColors.length-1]:visibleIndividuals[r][0],s=r=="others"?selectedColors[selectedColors.length-1]:visibleIndividuals[r][1];svgDoc.getElementById("color_"+id).setAttribute("stroke-width",t),svgDoc.getElementById("color_"+id).setAttribute("fill",i);var o=svgDoc.getElementById("label_"+id),u=o.firstChild.data;o.setAttribute("font-weight","normal"),o.removeChild(o.firstChild),o.appendChild(svgDoc.createTextNode(u));var a=svgDoc.getElementById("pie_container"),f;for(f=0;f<numPies;f++){var l=svgDoc.getElementById("slice_"+f+"_"+id);l!=null&&(l.setAttribute("stroke-width",t),l.setAttribute("fill",i),a.removeChild(l),a.appendChild(l))}}function getSelectedRgb(e){var t=[],n=0;for(n=0;n<3;n++){var r=e[n];r=Math.ceil(r*.45),t[n]=r}return t}function incrementColor(e,t){function n(t,n){return e[t]==e[n]?n-t:e[t]-e[n]}indices=[0,1,2],indices.sort(n),max=e[indices[2]],min=e[indices[0]],middle=e[indices[1]],difference=max-min,t%=360,fullTurnDistance=6*difference,incrementDistance=t*fullTurnDistance/360,newRgb=[e[0],e[1],e[2]],lowIndex=indices[0],middleIndex=indices[1],highIndex=indices[2];while(incrementDistance>0)incrementDistance<newRgb[highIndex]-newRgb[middleIndex]?(newRgb[middleIndex]=middle+incrementDistance,incrementDistance=0):(incrementDistance-=newRgb[highIndex]-newRgb[middleIndex],newRgb[middleIndex]=max,subtractIncrement=incrementDistance<difference?incrementDistance:difference,newRgb[highIndex]=newRgb[highIndex]-subtractIncrement,incrementDistance-=subtractIncrement,oldHighIndex=highIndex,highIndex=middleIndex,middleIndex=lowIndex,lowIndex=oldHighIndex);return newRgb}function getColorStr(e){function t(e){return e<16?"0"+Math.floor(e).toString(16):Math.floor(e).toString(16)}return"#"+t(e[0])+t(e[1])+t(e[2])}var svgNs="http://www.w3.org/2000/svg",svgDoc,selectedId=null,topCoor=1,leftCoor=1,bottomCoor=1600,rightCoor=1600,initialized=!1,visibleIndividuals=[],otherIndividuals=[],unselectedColors=[],selectedColors=[],orderedNames=[],numVisible=0,numPies=0;